version: '3.7'
services:
    # postgres:
    #     image: postgres:9.6
    #     environment:
    #         - POSTGRES_USER=airflow
    #         - POSTGRES_PASSWORD=airflow
    #         - POSTGRES_DB=airflow
    #     logging:
    #         options:
    #             max-size: 10m
    #             max-file: "3"
    webserver:
        # image: puckel/docker-airflow:1.10.9
        # image: airflow_image:latest
        build:
            context: .
            dockerfile: Dockerfile
        restart: always
        # depends_on:
        #     - postgres
        # environment:
            # - LOAD_EX=n
            # - EXECUTOR=Local
            # - AIRFLOW__CORE__FERNET_KEY=RVM3ogUH-76OivN5rU3zm3LGiN2b3XSqqB1kSBoNLAM= # DELETE this, already defined in dockerfile
        logging:
            options:
                max-size: 10m
                max-file: "3"
        volumes:
            - ./logs:/usr/local/airflow/logs
        ports:
            - "8080:8080"
        command: webserver
        healthcheck:
            test: ["CMD-SHELL", "[ -f /usr/local/airflow/airflow-webserver.pid ]"]
            interval: 30s
            timeout: 30s
            retries: 3
